(function(a){a.Jcrush=function(m,b){var c=a.extend({},a.Jcrush.defaults),i,h,q,k,u,g;function p(w){return parseInt(w,10)+"px"}var e=(function(){var D=0,C=0,G=0,A=0;function z(){return{x:D,y:C,w:G,h:A}}function F(w){D=w[0];C=w[1];G=w[2];A=w[3]}function E(){return[G,A]}function I(w){G=w[0];A=w[1]}function B(){return[D,C]}function H(w){D=w[0];C=w[1];c.onChange.call(o,e.getSelection())}return{getSelection:z,setSelection:F,getSelectionSize:E,setSelectionSize:I,getSelectionOrigin:B,setSelectionOrigin:H}}());function s(z){if(typeof(z)!=="object"){z={}}c=a.extend(c,z);if(typeof(c.onChange)!=="function"){c.onChange=function(){}}if(typeof(c.onSelect)!=="function"){c.onSelect=function(){}}if(typeof(c.onRelease)!=="function"){c.onRelease=function(){}}var A=u>=c.selectionWidth?c.selectionWidth:u,w=g>=c.selectionHeight?c.selectionHeight:g;e.setSelection([c.selectionOriginX,c.selectionOriginY,A,w]);c.crushID=parseInt(Math.random()*1000000,10)}if(typeof(m)!=="object"){m=a(m)[0]}if(typeof(b)!=="object"){b={}}i=a(m);function l(){s(b);var w=u>c.selectionWidth||g>c.selectionHeight;d(w)}function v(){img=new Image();h=a(img);h.load(function(){h.unbind();u=i.width();g=i.height();h.attr("id","");h.css("display","block");l()});h.attr("class",i.attr("class")).attr("src",i.attr("src"))}v();function t(w,C){var z=e.getSelectionSize(),B=u>=z[0]?u-z[0]:0,A=g>=z[1]?g-z[1]:0;e.setSelectionOrigin([w,C]);h.css("left",p(B-w));h.css("top",p(A-C))}function r(H){var G=e.getSelectionSize(),D=e.getSelectionOrigin(),z=u-c.selectionWidth,w=g-c.selectionHeight,A=u>=c.selectionWidth?u:c.selectionWidth,F=g>=c.selectionHeight?g:c.selectionHeight,B=u>=c.selectionWidth?z:z/2,C=g>=c.selectionHeight?w:w/2,E=h.attr("class");q=a(document.createElement("div"));q.attr("id","crush_wrapper"+c.crushID);q.attr("class","crush_wrapper");q.css("position","absolute");q.width(A+z);q.height(F+w);q.css("cursor",c.cursor);q.css("clip","rect("+p(w)+" "+p(A)+" "+p(F)+" "+p(z)+")");q.css("left",p(-B));q.css("top",p(-C));k=a(document.createElement("div"));k.attr("id",c.anchor+c.crushID);k.addClass("crush_container");k.addClass(E);k.css("position","relative");k.css("overflow","hidden");k.css("width",p(c.selectionWidth));k.css("height",p(c.selectionHeight));k.css("display","block");k.append(q);h.attr("class","");t(D[0],D[1]);q.append(h);if(H&&c.allowMove&&c.showHint){$hint=a(document.createElement("label"));$hint.css("position","absolute").css("left",p(B+((c.selectionWidth-80)/2))).css("top",p(C+((c.selectionHeight-44)/2))).css("font-size","14px").css("width","70px").css("height","34px").css("background-color","#434343").css("color","white").css("cursor",c.cursor).css("opacity","0.7").css("border-radius","8px").css("padding","5px");$hint.html(c.hintMessage);$hint.disableSelection().mousedown(function(I){h.trigger(I);return false});q.append($hint)}i.replaceWith(k)}function f(B,D){var C=navigator.userAgent.toLowerCase(),E=a(window).scrollTop();var A=parseInt(D.position.left,10),z=parseInt(D.position.top,10),w=e.getSelectionSize();if(C.match(/firefox/)){z+=E}x=h.width()>=c.selectionWidth?h.width()-(A+w[0]):0;y=h.height()>=c.selectionHeight?h.height()-(z+w[1]):0;e.setSelectionOrigin([x,y])}function n(w){h.draggable("option","disabled",!w)}function d(w){if(!w||!c.allowMove){c.cursor="standard"}r(w);h.draggable({containment:"parent",cursor:c.cursor,drag:f});a(document).scroll(function(){a(document).trigger("mouseup")});var z=navigator.userAgent.toLowerCase(),A;if(z.match(/firefox/)&&c.allowMove){h.bind("dragstart",function(B,C){A=a(window).scrollTop();a(this).css("margin-top",A)});h.bind("dragstop",function(B,C){a(this).css("margin-top","");a(this).css("top",p(A+parseInt(a(this).css("top"),10)))})}n(c.allowMove&&w)}function j(w){i.unbind();i.attr("src","");c.cursor="move";b.selectionOriginX=0;b.selectionOriginY=0;i.load(function(){i.unbind();v()});i.attr("src",w);i.hide();k.replaceWith(i)}var o={allowMove:n,moveImage:t,updateImage:j};return o};a.Jcrush.defaults={allowMove:true,showHint:true,hintMessage:"Drag to reposition",onChange:function(){},onSelect:function(){},onRelease:function(){},selectionHeight:300,selectionWidth:300,selectionOriginX:0,selectionOriginY:0,cursor:"move",anchor:"crush_container"};a.fn.disableSelection=function(){return this.each(function(){a(this).attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return false}})})}}(jQuery));