(function(a){a.Jcrush=function(m,b){var c=a.extend({},a.Jcrush.defaults),i,h,q,k,u,g;function p(w){return parseInt(w,10)+"px"}var e=(function(){var D=0,C=0,G=0,A=0;function z(){return{x:D,y:C,w:G,h:A}}function F(w){D=w[0];C=w[1];G=w[2];A=w[3]}function E(){return[G,A]}function I(w){G=w[0];A=w[1]}function B(){return[D,C]}function H(w){D=w[0];C=w[1];c.onChange.call(o,e.getSelection())}return{getSelection:z,setSelection:F,getSelectionSize:E,setSelectionSize:I,getSelectionOrigin:B,setSelectionOrigin:H}}());function s(w){if(typeof(w)!=="object"){w={}}c=a.extend(c,w);if(typeof(c.onChange)!=="function"){c.onChange=function(){}}if(typeof(c.onSelect)!=="function"){c.onSelect=function(){}}if(typeof(c.onRelease)!=="function"){c.onRelease=function(){}}e.setSelection([c.selectionOriginX,c.selectionOriginY,c.selectionWidth,c.selectionHeight]);c.crushID=parseInt(Math.random()*1000000,10)}if(typeof(m)!=="object"){m=a(m)[0]}if(typeof(b)!=="object"){b={}}i=a(m);function l(){s(b);var w=u>c.selectionWidth||g>c.selectionHeight;d(w)}function v(){img=new Image();h=a(img);h.load(function(){h.unbind();u=i.width();g=i.height();h.attr("id","");h.css("display","block");l()});h.attr("class",i.attr("class")).attr("src",i.attr("src"))}v();function t(w,C){var z=e.getSelectionSize(),B=u-z[0],A=g-z[1];e.setSelectionOrigin([w,C]);h.css("left",p(B-w));h.css("top",p(A-C))}function r(w){var A=e.getSelectionSize(),z=e.getSelectionOrigin(),C=u-A[0],B=g-A[1],D=h.attr("class");q=a(document.createElement("div"));q.attr("id","crush_wrapper"+c.crushID);q.css("position","absolute");q.width(u+C);q.height(g+B);q.css("cursor",c.cursor);q.css("clip","rect("+p(B)+","+p(u)+","+p(g)+","+p(C)+")");q.css("left","-"+p(C));q.css("top","-"+p(B));k=a(document.createElement("div"));k.attr("id",c.anchor+c.crushID);k.addClass(D);k.css("position","relative");k.css("overflow","hidden");k.css("width",p(A[0]));k.css("height",p(A[1]));k.css("display","block");k.append(q);h.attr("class","");t(z[0],z[1]);q.append(h);if(w&&c.allowMove&&c.showHint){$hint=a(document.createElement("label"));$hint.css("position","absolute").css("left",p(C+((A[0]-80)/2))).css("top",p(B+((A[1]-44)/2))).css("font-size","14px").css("width","70px").css("height","34px").css("background-color","#434343").css("color","white").css("cursor",c.cursor).css("opacity","0.7").css("border-radius","8px").css("padding","5px");$hint.html(c.hintMessage);$hint.disableSelection().mousedown(function(E){h.trigger(E);return false});q.append($hint)}i.replaceWith(k)}function f(B,D){var C=navigator.userAgent.toLowerCase(),E=a(window).scrollTop();var A=parseInt(D.position.left,10),z=parseInt(D.position.top,10),w=e.getSelectionSize();if(C.match(/firefox/)){z+=E}x=h.width()-(A+w[0]);y=h.height()-(z+w[1]);e.setSelectionOrigin([x,y])}function n(w){h.draggable("option","disabled",!w)}function d(w){if(!w||!c.allowMove){c.cursor="standard"}r(w);h.draggable({containment:"parent",cursor:c.cursor,drag:f});a(document).scroll(function(){a(document).trigger("mouseup")});var z=navigator.userAgent.toLowerCase(),A;if(z.match(/firefox/)&&c.allowMove){h.bind("dragstart",function(B,C){A=a(window).scrollTop();a(this).css("margin-top",A)});h.bind("dragstop",function(B,C){a(this).css("margin-top","");a(this).css("top",p(A+parseInt(a(this).css("top"),10)))})}n(c.allowMove&&w)}function j(w){i.unbind();c.cursor="move";b.selectionOriginX=0;b.selectionOriginY=0;i.load(function(){i.unbind();v()});i.attr("src",w);i.hide();k.replaceWith(i)}var o={allowMove:n,moveImage:t,updateImage:j};return o};a.Jcrush.defaults={allowMove:true,showHint:true,hintMessage:"Drag to reposition",onChange:function(){},onSelect:function(){},onRelease:function(){},selectionHeight:300,selectionWidth:300,selectionOriginX:0,selectionOriginY:0,cursor:"move",anchor:"crush_container"};a.fn.disableSelection=function(){return this.each(function(){a(this).attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return false}})})}}(jQuery));
